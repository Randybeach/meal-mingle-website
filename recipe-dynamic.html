<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe - Meal Mingle</title>
    
    <!-- Default Open Graph (updated by JS) -->
    <meta property="og:title" content="Check out this recipe on Meal Mingle!" id="og-title">
    <meta property="og:description" content="Delicious recipe shared with love" id="og-desc">
    <meta property="og:image" content="https://meal-mingle.app/images/recipe-preview.png" id="og-image">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=GFS+Didot&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <header>
        <nav class="container">
            <a href="/" class="logo"><span class="dot"></span> Meal Mingle</a>
            <div class="nav">
                <a href="https://apps.apple.com/app/meal-mingle/id6754255710" class="btn outline">Download App</a>
            </div>
        </nav>
    </header>

    <main class="container section">
        <div style="text-align: center; max-width: 600px; margin: 0 auto;" id="content">
            <span class="tag primary">üç≥ Recipe Share</span>
            <h1 id="recipe-title">Loading recipe...</h1>
            <p class="lead" id="recipe-desc">Please wait while we load the recipe details.</p>
            
            <div style="margin-top: 32px;">
                <a href="#" onclick="openApp(); return false;" class="btn btn-full">
                    Open in Meal Mingle
                </a>
            </div>
            
            <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--ring);">
                <p style="color: var(--muted); font-size: 14px; margin-bottom: 16px;">Don't have the app yet?</p>
                <div class="store-row" style="justify-content: center;">
                    <a href="https://apps.apple.com/app/meal-mingle/id6754255710" class="store-badge">
                        <img src="/assets/images/apple-store.svg" alt="Download on App Store" class="store-img">
                    </a>
                </div>
            </div>
        </div>
    </main>

    <script>
        const recipeId = window.location.pathname.split('/').pop();
        
        async function loadRecipe() {
            if (!recipeId || recipeId === 'recipe-dynamic.html') return;
            
            try {
                const response = await fetch(`https://recip-c4b96-default-rtdb.firebaseio.com/recipes/${recipeId}.json`);
                const recipe = await response.json();
                
                if (recipe) {
                    // Update page content
                    document.getElementById('recipe-title').textContent = recipe.title || 'Delicious Recipe';
                    document.getElementById('recipe-desc').textContent = recipe.instructions ? 
                        recipe.instructions.substring(0, 150) + '...' : 'Discover amazing recipes on Meal Mingle';
                    
                    // Update meta tags
                    document.getElementById('og-title').setAttribute('content', recipe.title || 'Delicious Recipe');
                    document.getElementById('og-desc').setAttribute('content', recipe.instructions ? 
                        recipe.instructions.substring(0, 150) + '...' : 'Discover amazing recipes on Meal Mingle');
                    if (recipe.imageUrl) {
                        document.getElementById('og-image').setAttribute('content', recipe.imageUrl);
                    }
                    
                    // Add recipe image
                    if (recipe.imageUrl) {
                        const img = document.createElement('img');
                        img.src = recipe.imageUrl;
                        img.alt = recipe.title;
                        img.style.cssText = 'width: 100%; max-width: 400px; border-radius: 16px; margin-bottom: 24px;';
                        document.getElementById('content').insertBefore(img, document.getElementById('recipe-title'));
                    }
                } else {
                    document.getElementById('recipe-title').textContent = 'Recipe Not Found';
                    document.getElementById('recipe-desc').textContent = 'This recipe might have been removed or the link is incorrect.';
                }
            } catch (error) {
                console.error('Failed to load recipe:', error);
            }
        }
        
        function openApp() {
            if (recipeId && recipeId !== 'recipe-dynamic.html') {
                window.location.href = `mealmingle://recipe/${recipeId}`;
            }
        }
        
        // Auto-open app on mobile
        if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
            if (recipeId && recipeId !== 'recipe-dynamic.html') {
                setTimeout(() => openApp(), 1000);
            }
        }
        
        // Load recipe data
        loadRecipe();
    </script>
</body>
</html>